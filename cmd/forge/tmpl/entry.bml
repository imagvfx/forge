<!doctype html>
<html> [
	<head> [
		{{template "style"}}
	]
	<body> [
		{{template "nav" $}}
		<div class="main"> [
			<div class="left"> [
				<div style="display:flex;align-items:center"> [
					<h1> [
						{{pathLinks $.Entry.Path}}
					]
					<div style="flex:1;min-width:1rem"> []
					<!-- Search Box -->
					{{if ne $.Entry.Path "/"}}
					<form style="display:flex"> [
						<select name="search_entry_type" class="search-box-left"> [
						{{range $t := $.AllEntryTypes}}
							<option value="{{$t}}" {{if eq $t $.UserSetting.EntryPageSearchEntryType}}selected{{end}}> [{{$t}}]
						{{end}}
						]
						<input name="search_query" type="text" class="search-box-center" style="width:20rem" placeholder="search" value="{{$.SearchQuery}}"> []
						<button class="search-box-right" style="background-color:inherit"> [Go]
					]
					{{end}}
				]
				<div> [
				{{if $.ResultsFromSearch}}
					{{if not $.SubEntriesByTypeByParent}}No search results{{end}}
				{{else}}
					{{if not $.SubEntriesByTypeByParent}}No children{{end}}
				{{end}}
				{{range $t, $entsByParent := $.SubEntriesByTypeByParent}}
					<div style="display:flex;align-items:center"> [
						<H4 style="margin-right:5px"> [{{$t}}]
						<!-- Property Filter -->
						<form action="/api/set-user-setting" method="POST"> [
							<input name="entry_page_entry_type" type="hidden" value="{{$t}}"> []
							<input name="entry_page_property_filter" type="text" style="border:1px solid #DDD;border-radius:2px;width:20rem;background-color:inherit;color:#AAA" value="{{index $.UserSetting.EntryPagePropertyFilter $t}}"> []
							<button style="display:none" name="update_filter" value="1"> []
							<input readonly name="back_to_referer" type="hidden" value="1"> []
						]
						<div style="flex:1"> []
						<!-- Sort -->
						<form action="/api/set-user-setting" style="display:flex;align-items:center" method="POST"> [
							<input name="entry_page_entry_type" type="hidden" value="{{$t}}"> []
							{{$sortProp := index $.UserSetting.EntryPageSortProperty $t}}
							{{$prop := sortProperty $sortProp}}
							{{$desc := sortDesc $sortProp}}
							<select name="entry_page_sort_property" style="appearance:none;min-width:6rem;height:1.2rem;border:1px solid #DDD;border-radius:2px;padding:0 0.3rem;"> [
								<option value=""> [(name)]
							{{range $p := index $.DefaultProperties $t}}
								<option value="{{$p}}" {{if eq $p $prop}}selected{{end}}> [{{$p}}]
							{{end}}
							]
							<input id="sort_desc_cb" name="entry_page_sort_desc" style="margin-right:0;width:1.2rem;height:1.2rem;border-radius:2px 0 0 2px;background-color:#F3F3F3" type="checkbox" {{if $desc}}checked{{end}}> []
							<button name="update_sort" style="appearance:none;height:1.2rem;border:1px solid #DDD;border-left:0;border-radius:0 2px 2px 0;background-color:#F3F3F3" value="1"> [Sort]
							<input readonly name="back_to_referer" type="hidden" value="1"> []
						]
					]
					{{$i := 0}}
					{{range $parent, $entries := $entsByParent}}
						{{if $entries}}
							{{if $i}}
							<div style="height:1rem"> []
							{{end}}
							{{if $.ResultsFromSearch}}<h5> [From <a href="{{$parent}}"> [{{$parent}}]]{{end}}
							<div style="height:0.5rem"> []
							<div style="display:grid;grid-template-columns:1fr;border:1px solid #DDD;border-radius:4px"> [
								{{$propFilters := index $.PropertyFilters $t}}
								{{range $j, $e := $entries}}
								{{$props := index $.SubEntryProperties $e.Path}}
								{{$pad := "0.3rem"}}
								{{if $j}}
								<div style="border-top:1px solid #DDD"> []
								{{end}}
								<div style="display:flex"> [
									<a style="padding:{{$pad}};width:96px" href="{{$e.Path}}"> [
										{{if $e.HasThumbnail}}
										<img src="/thumbnail{{$e.Path}}" width="96px" height="54px" alt="" style="border:1px solid #CCCCCC;background-color:#DDDDDD;vertical-align:middle"> []
										{{else}}
										<div style="width:96px;height:54px;border:1px solid #CCCCCC;background-color:#DDDDDD"> []
										{{end}}
										<div style="margin-top:{{$pad}};width:96px;color:black"> [<b> [{{$e.Name}}]]
									]
									<div style="flex:1;padding:{{$pad}};display:grid;grid-template-columns:repeat({{min (len $propFilters) 4}}, 1fr)"> [
										{{range $name := $propFilters}}
											<div> [
												<div style="font-size:0.75rem;color:#AAA"> [{{$name}}]
												{{$p := index $props $name}}
												{{if $p}}
												<div style="height:0.2rem"> []
												<div style="font-size:0.8rem"> [{{$p.Value}}]
												{{end}}
											]
										{{end}}
									]
								]
								{{end}}
							]
						{{$i = inc $i}}
						{{end}}
					{{end}}
				{{end}}
				]
			]
			<div class="right"> [
				<h4> [
					<div style="display:flex"> [
						<a href="?tab=view"> [View]
						<div style="width:0.5rem"> []
						<a href="?tab=edit"> [Edit]
						<div style="width:0.5rem"> []
						<a href="?tab=delete"> [Delete]
						<div style="flex:1"> []
						<a href="?tab=logs"> [Logs]
					]
				]
				{{if eq $.UserSetting.EntryPageTab "view"}}
					{{template "entry-view-tab" $}}
				{{else if eq $.UserSetting.EntryPageTab "edit"}}
					{{template "entry-edit-tab" $}}
				{{else if eq $.UserSetting.EntryPageTab "delete"}}
					{{template "entry-delete-tab" $}}
				{{end}}
			]
		]
	]
]

<script> [`
function toggleCollapse() {
	let collapsible = this.parentElement;
	let content = collapsible.getElementsByClassName("content")[0];
	if (content.style.display == "none") {
		content.style.display = "block";
	} else {
		content.style.display = "none";
	}
}

var coll = document.getElementsByClassName("collapsible");
for (i = 0; i < coll.length; i++) {
	coll[i].getElementsByClassName("title")[0].addEventListener("click", toggleCollapse);
}
`]
