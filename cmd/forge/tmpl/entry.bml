<!doctype html>
<html> [
	<head> [
		{{template "style"}}
	]
	<body> [
		{{template "nav" $}}
		<div style="display:flex;justify-content:space-between"> [
			<div name="left" style="flex:1;margin-right:1rem"> [
				<h1> [
					{{pathLinks $.Entry.Path}} ({{$.Entry.Type}})
				]
				<h4> [
					Sub Entry
				]
				<div> [
				{{range $i, $t := $.SubEntryTypes}}
					{{if $i}}
					<div style="height:1rem"> []
					{{end}}
					<div> [{{$t}}]
					<div style="display:grid;grid-template-columns:1fr;border-top:1px solid #DDD;border-left:1px solid #DDD"> [
						{{$entries := index $.SubEntriesByType $t}}
						{{$props := index $.SubEntryProperties $t}}
						{{$defaultProps := index $.DefaultProperties $t}}
						{{range $j, $e := $entries}}
						{{$pad := "0.5rem"}}
						<div style="display:flex;padding:{{$pad}};border-bottom:1px solid #DDD;border-right:1px solid #DDD"> [
							<a style="display:flex" href="{{$e.Path}}"> [
								<img src="/thumbnail{{$e.Path}}" height="60px" width="90px" alt="" style="border:1px solid #AAAAAA"> []
								<div style="width:{{$pad}}"> []
								<div style="width:90px"> [{{$e.Name}}]
							]
							<div style="flex:1;display:grid;grid-template-columns:repeat(4, 1fr)"> [
								{{range $name := $defaultProps}}
									<div> [
										<div style="font-size:0.75rem;color:#AAA"> [{{$name}}]
										{{$p := index $props $name}}
										{{if $p}}
										<div style="height:0.2rem"> []
										<div style="font-size:0.8rem"> [{{$p.Value}}]
										{{end}}
									]
								{{end}}
							]
						]
						{{end}}
					]
				{{end}}
				]
			]
			<div name="right" style="width:600px"> [
				<h4> [
					<div style="display:flex"> [
						<a href="?"> [View]
						<div style="width:0.5rem"> []
						<a href="?tab=edit"> [Edit]
						<div style="width:0.5rem"> []
						<a href="?tab=delete"> [Delete]
						<div style="flex:1"> []
						<a href="?tab=logs"> [Logs]
					]
				]
				<h4> [
					<img src="/thumbnail{{$.Entry.Path}}" height="108" width="192" alt="" style="border:1px solid #AAAAAA"> []
				]
				<div style="height:1px"> []
				<div class="collapsible"> [
					<h4 class="title" style="cursor:pointer"> [
						Property ({{len $.Properties}})
					]
					<div class="content"> [
					{{range $p := $.Properties}}
						<div> [{{$p.Name}}{{if $p.Eval}} = {{$p.Eval}}{{end}} <a style="color:#bbb" href="?tab=logs&category=property&name={{$p.Name}}"> [(history)]]
					{{end}}
					]
				]
				<div class="collapsible"> [
					<h4 class="title" style="cursor:pointer"> [
						Environ ({{len $.Environs}})
					]
					<div class="content" style="display:none"> [
					{{range $e := $.Environs}}
						{{$inherit := ne $e.EntryPath $.Entry.Path}}
						{{if $inherit}}
							<div> [<a href="{{$e.EntryPath}}"> [{{$e.Name}}{{if $e.Eval}} = {{$e.Eval}}{{end}}]]
						{{else}}
							<div> [{{$e.Name}}{{if $e.Eval}} = {{$e.Eval}}{{end}} <a style="color:#bbb" href="?tab=logs&category=environ&name={{$e.Name}}"> [(history)]]
						{{end}}
					{{end}}
					]
				]
				<div class="collapsible"> [
					<h4 class="title" style="cursor:pointer"> [
						Access Control ({{len $.AccessControls}})
					]
					<div class="content" style="display:none"> [
					{{range $a := $.AccessControls}}
						{{$inherit := ne $a.EntryPath $.Entry.Path}}
						{{if $inherit}}
							<div> [<a href="{{$a.EntryPath}}"> [{{$a.Accessor}} {{$a.AccessorType}} = {{$a.Mode}}]]
						{{else}}
							<div> [{{$a.Accessor}} {{$a.AccessorType}} = {{$a.Mode}} <a style="color:#bbb" href="?tab=logs&category=access&name={{$a.Accessor}}"> [(history)]]
						{{end}}
					{{end}}
					]
				]
			]
		]
	]
]

<script> [`
function toggleCollapse() {
	let collapsible = this.parentElement;
	let content = collapsible.getElementsByClassName("content")[0];
	if (content.style.display == "none") {
		content.style.display = "block";
	} else {
		content.style.display = "none";
	}
}

var coll = document.getElementsByClassName("collapsible");
for (i = 0; i < coll.length; i++) {
	coll[i].getElementsByClassName("title")[0].addEventListener("click", toggleCollapse);
}
`]
